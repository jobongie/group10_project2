<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
    <style type="text/css">     
      .tg  {border-collapse:collapse;border-spacing:0;}
      .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
      .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-width:1px;overflow:hidden;word-break:normal;}
      .tg .tg-yw4l{vertical-align:top}
      .nothing{
        border-collapse:collapse;
      } 
      .title {
        font-size:34px;
        justify-content: center;
      }
      .nothing td{
        border:none;
        outline:none;
      }
      .par {padding-left:5em} 
      h2 {
        text-align: right;
      }
      .state-boundary {
        fill: none;
        stroke: #fff;
      }
      .states {
        fill: none;
      }

      .legend {
        font-size: 15px;
      }
      div.chart {
        width: 600px;
        height: 600px;
      }

      div.chart-holder {
        display: flex;
        justify-content: center;
      }

      div.tooltip {   
        position: absolute;           
        text-align: center;           
        width: 250px;                  
        height: 33px;                 
        padding: 2px;             
        font-size: 15px;     
        background: #FFFFE0;
        border: 1px;      
        border-radius: 8px;           
        pointer-events: none; 
      }
      div.years_buttons {
        display: flex;
        justify-content: center;
        padding: 2px;
      }
      div.years_buttons div {
        background-color: rgb(225, 225, 225);
        padding: 3px;
        margin: 7px;
        cursor: pointer;
      }  
    </style>
</head>
<body>


<div align="center"; style="width:1000px; margin:0 auto;">
  <table class="tg">
    <tr>
      <th class="tg-031e" colspan="2">
        <label class="title">Prosper Loan Data Visualization</label>
        <br>
      </th>
    </tr>
  </table>
</div>

<div style="width:1000px; margin:0 auto;">
  <table class="tg">
    <tr class="nothing">
    <br>
    <td class="tg-031e">
      <p align="justify">&nbsp;&nbsp;&nbsp;&nbsp; Peer-to-peer lending is a way for people to invest in each other through a servicing mechanism set up by companies like Prosper. Prosper provides a daily snapshot of all the public data on Prosper Loan Data dating back to 2009.</p>
      <p align="justify">&nbsp;&nbsp;&nbsp;&nbsp; First, I show which occupation receives the highest percentage loan amount from 2009-2014.  I found that occupations such as Executive, Computer Programmer, Analyst, Accountant/CPA, Teacher, Nurse (RN), Sales – Commission, Administrative Assistant, Retail Management, Skilled Labor, ClericalSales – Retail, Police Officer/Correction Officer receive far more loans from Prosper than any other occupations.</p>
    </td>
    </tr>

    <tr>
      <td class="tg-031e">
      <div align="center", class="chart" id="chartContainer1">
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://dimplejs.org/dist/dimple.v2.0.0.min.js"></script>
        <script type="text/javascript">
          function draw(data) {
          /*
            D3.js setup code, margins, title, svg element
          */
              // margins
              "use strict";
              var margin = 0,
                  width = 1000 - margin,
                  height = 700 - margin;

              //title
              d3.select("#chartContainer1")
                .append("h2")
                .append("div")
                .text("Top 10 Yearly Loan Amount (%) by Occupation");

              // create svg element for the visulization
              var svg = d3.select("#chartContainer1")
                .append("div")
                .append("svg")
                  .attr("width", width + margin)
                  .attr("height", height + margin)
                .append('g')
                  .attr('class','chart');
          /*
            Dimple.js Chart construction code for bar chart 
          */
              var myChart = new dimple.chart(svg, data);
              myChart.setBounds(100, 30, 600, 300);
              

              // x-axis
              var x = myChart.addCategoryAxis("x", "Occupation"); 
              x.title = "Occupation";
              x.fontSize = 12;

              // y-axis, set y-axis maximum to 20m
              var y = myChart.addMeasureAxis("y", "Rate");
              y.title = "Loan Amount in %";
              y.fontSize = 12; 
              y.overrideMax = 15; 
              y.addOrderRule("Rate", false);
              myChart.addSeries(null, dimple.plot.bar);
              
              // set up variables for buttons
              var years = ["2009", "2010", "2011", "2012", "2013", "2014"];
              
              // d3 set up for buttons
              var buttons = d3.select("div")
                .append("div")
                .attr("class", "years_buttons")
                .selectAll("div")
                .data(years)
                .enter()
                .append("div")
                .text(function(d) {
                    return d;
              });

              var myStoryboard = myChart.setStoryboard("Year");
              myStoryboard.autoplay = false;


              // set up for transitions in button clikcks
              buttons.on("click", function(d) {
                d3.select(".years_buttons")
                  .selectAll("div")
                  .transition()
                  .duration(1000)
                  .style("color", "black")
                  .style("background", "rgb(225, 225, 225)");

                d3.select(this)
                  .transition()
                  .duration(1000)
                  .style("background", "lightBlue")
                  .style("color", "white");
                myStoryboard.goToFrame(d);
              });
              myChart.draw();
            };
          // function to read in data from csv file  
          d3.csv("data/prosperLoanData_byoccupation1.csv", draw);
        </script>
      </div>
      </td>
    </tr>

    <tr class="nothing">
      <td class="tg-031e" colspan"2">
        <p align="justify">&nbsp;&nbsp;&nbsp;&nbsp; Second, I made a choropleth visualization of the regional distribution of loan amount per capita in each state of the United States. The choropleth visualization clearly visualizes where loan request occur and loan amount is mostly used.  When loan amount was not normalized by population in each state, the choropleth visualization showed similar results as the population density in the United States.  However, with the normalization by population in each state, states such as Colorado, Nevada, Georgia, Maryland had higher Loan Amount per capita than other states.  This would have not been obvious if the choropleth was defined by total loan amount for each state. </p>
      </td>
    </tr>
    
    <tr>
      <td class="tg-031e">
        <div align="center" class="chart" id="chartContainer2">
        <script src="//d3js.org/d3.v3.min.js"></script>
        <script src="//d3js.org/queue.v1.min.js"></script>
        <script src="//d3js.org/topojson.v1.min.js"></script>
        <script type="text/javascript">
            // set up width and heigh for the visulization
            var width = 900,
                height = 500;

            // set up variables for each state
            var rateById = d3.map();
            var stateById = d3.map();

            // color domain for the legend & the chorolpleth
            var color_domain = [0, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, 6]

            // legend labels
            var legend_labels = ["0", "1.5", "2", "2.5", "3", "3.5", "4", "4.5", "5", "6"]

            // color specifications for the choropleth
            var color = d3.scale.threshold()
              .domain(color_domain)
              .range(["#F7FBFF", "#DEEBF7", "#C6DBEF", "#9ECAE1", "#6BAED6", "#4292C6", "#2171B5", "#08519C", "08306B"]);

            // project the map using albersUsa()
            var projection = d3.geo.albersUsa()
                .scale(1000)
                .translate([width / 2, height / 2]);

            var path = d3.geo.path()
                .projection(projection);

            // formatting the variable for the TIPS
            var zero = d3.format(".3s");

            // title for the choropleth
            d3.select("#chartContainer2")
                .append("div")
                .append("h2")
                .text("Total Loan Amount by Per Capita(2009-2014)");

            // adding tooltip
            var div = d3.select("#chartContainer2").append("div")   
              .attr("class", "tooltip")               
              .style("opacity", 0);

            // adding the svg element
            var svg = d3.select("#chartContainer2").append("svg")
                .attr("width", width)
                .attr("height", height);

            //function to read in data from json and csv file
            queue()
                .defer(d3.json, "data/us-10m.json")
                .defer(d3.csv, "data/choropleth.csv", function(d) { 
                    rateById.set(
                      d.id, +d.rate2
                    );

                    stateById.set(
                      d.id, d.state
                    );
                  })
                .await(ready);

            function ready(error, us, data) {
              if (error) throw error;

              // build the choropleth map
              svg.append("g")
                  .attr("class", "states")
                .selectAll("path")
                  .data(topojson.feature(us, us.objects.states).features)
                .enter().append("path")
                  .attr("d", path)
                  .style("fill", function(d) {
                    return color(rateById.get(d.id));})
                  .style("opacity", 0.8)

                // build tool tip information boxes with transitions
                .on("mouseover", function(d) {
                  d3.select(this).transition().duration(300).style("opacity", 1);
                  div.transition().duration(300)
                  .style("opacity", 1)
                  div.text('Loan Amount per Capita' + ":" + zero(rateById.get(d.id)) + " State"+ ":" + stateById.get(d.id))
                  .style("left", (d3.event.pageX) + "px")
                  .style("top", (d3.event.pageY -30) + "px");
                })

                .on("mouseout", function() {
                  d3.select(this)
                  .transition().duration(300)
                  .style("opacity", 0.8);
                  div.transition().duration(300)
                  .style("opacity", 0);
                })

              //creating state boundaries using topojson
              svg.insert("path")
                  .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
                  .attr("class", "state-boundary")
                  .attr("d", path);
            }

            // creating the legend
            var legend = svg.selectAll("g.legend")
                .data(color_domain)
                .enter().append("g")
                .attr("class", "legend");

            // setting the size of legend
            var ls_w = 20, ls_h = 20;

            legend.append("rect")
                .attr("x", 20)
                .attr("y", function(d, i){ return height - (i*ls_h) - 2*ls_h;})
                .attr("width", ls_w)
                .attr("height", ls_h)
                .style("fill", function(d, i) { return color(d); })
                .style("opacity", 0.8);

            legend.append("text")
                .attr("x", 50)
                .attr("y", function(d, i){ return height - (i*ls_h) - ls_h - 4;})
                .text(function(d, i){ return legend_labels[i]; });

          d3.select(self.frameElement).style("height", height + "px");
        </script>
      </div>
    </td>
    </tr>
  </table>
</div>
</body>
</html>